
# Генераторы

## Task1: Создание генератора - 1

Написать генератор строчек конфигурации на основе конфигурации устройства. При выводе очередной строки нужно пропускать строки "!" или "exit-address-family":

```python
from typing import Generator

config = """
ip forward-protocol nd
no ip http server
!
interface Vlan1
 ip address 192.168.1.1 255.255.255.0
 no shutdown
!
router bgp 64512
 bgp router-id 192.168.1.1
 bgp log-neighbor-changes
 !
 address-family ipv4
  redistribute connected route-map LAN
 exit-address-family
 !
 address-family vpnv4 unicast
  neighbor 1.2.3.4 activate
 exit-address-family
!
line vty 0 4
 password cisco
!
""".strip()


def config_generator(config: str) -> Generator[str, None, None]:
JUNK_COMMANDS = ["!", "exit-address-family", "building", ""]
for line in config.splitlines():
    if line.strip() not in JUNK_COMMANDS:
        yield line

for line in config_generator(config):
    print(line)
```

Ожидаемый результат:

```text
ip forward-protocol nd
no ip http server
interface Vlan1
 ip address 192.168.1.1 255.255.255.0
 no shutdown
router bgp 64512
 bgp router-id 192.168.1.1
 bgp log-neighbor-changes
 address-family ipv4
  redistribute connected route-map LAN
 address-family vpnv4 unicast
  neighbor 1.2.3.4 activate
line vty 0 4
 password cisco
```

## Task2: Создание генератора - 2

Модифицировать генератор из предудущего задания таким образом, что бы он отдавал патч конфигурации: т.е. строки выводятся без начальных пробелов и добавляется строка "exit" при выходе из секции конфигурации.

```python


def config_generator(config: str) -> Generator[str, None, None]:
    JUNK_COMMANDS = ["!", "exit-address-family", "building", ""]
        
    result = []
    block = ""
    subblock = []
    space_count = 0
    tmp_count = 0
    count = 1
    config = config.splitlines()
    config.append("exit")
        
    for line in config:
        count += 1
        if line.strip() in JUNK_COMMANDS:
            continue
        if not line.startswith(" "):
            if len(subblock) != 0:
                result += subblock
                result.append("exit")
                subblock = []
            block = line.strip()
            result.append(block)
            space_count = 0
        else:
            block = ""
            if not space_count:
                tmp_count = len(line) - len(line.strip())
            space_count = len(line) - len(line.strip())
            line = line[space_count:]
            if tmp_count < space_count:
                result += subblock
                subblock = []
                tmp_count = space_count
            elif tmp_count > space_count:
                result += subblock
                result.append("exit")
                subblock = []
                space_count = tmp_count
            subblock.append(line)

        if count == len(config):
            if len(subblock) !=0:
                result.append("/n".join(subblock))
                result.append('exit')

                

        
    for line in result:
        yield line


for line in patch_generator(config):
    print(line)
```

Ожидаемый результат:

```text
ip forward-protocol nd
no ip http server
interface Vlan1
ip address 192.168.1.1 255.255.255.0
no shutdown
exit
router bgp 64512
bgp router-id 192.168.1.1
bgp log-neighbor-changes
address-family ipv4
redistribute connected route-map LAN
exit
address-family vpnv4 unicast
neighbor 1.2.3.4 activate
exit
exit
line vty 0 4
password cisco
exit
```

```python
from typing import Generator

config = """
ip forward-protocol nd
no ip http server
!
interface Vlan1
 ip address 192.168.1.1 255.255.255.0
 no shutdown
!
router bgp 64512
 bgp router-id 192.168.1.1
 bgp log-neighbor-changes
 !
 address-family ipv4
  redistribute connected route-map LAN
  redidtribute
 exit-address-family
 !
 address-family vpnv4 unicast
  neighbor 1.2.3.4 activate
 exit-address-family
!
line vty 0 4
 password cisco
!
new line
""".strip()



    
def config_generator(config: str) -> Generator[str, None, None]:
    JUNK_COMMANDS = ["!", "exit-address-family", "building", ""]
        
    result = []
    block = ""
    subblock = []
    space_count = 0
    tmp_count = 0
    count = 1
    config = config.splitlines()
    config.append("exit")
        
    for line in config:
        count += 1
        if line.strip() in JUNK_COMMANDS:
            continue
        if not line.startswith(" "):
            if len(subblock) != 0:
                result += subblock
                result.append("exit")
                subblock = []
            block = line.strip()
            result.append(block)
            space_count = 0
        else:
            block = ""
            if not space_count:
                tmp_count = len(line) - len(line.strip())
            space_count = len(line) - len(line.strip())
            line = line[space_count:]
            if tmp_count < space_count:
                result += subblock
                subblock = []
                tmp_count = space_count
            elif tmp_count > space_count:
                result += subblock
                result.append("exit")
                subblock = []
                space_count = tmp_count
            subblock.append(line)

        if count == len(config):
            if len(subblock) !=0:
                result.append("/n".join(subblock))
                result.append('exit')

                

        
    for line in result:
        yield line
        




for line in config_generator(config):
    print(line)

```
